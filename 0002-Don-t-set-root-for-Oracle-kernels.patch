From 8a77b8c2b1ccecbeb9d7db846e85820228d31676 Mon Sep 17 00:00:00 2001
From: William Douglas <william.douglas@intel.com>
Date: Fri, 18 May 2018 21:30:07 +0000
Subject: [PATCH 2/2] Don't set root= for Oracle kernels

Because the disk image the with the rootfs is coming from iscsi, the
root= kernel commandline option causes init to be unable to mount the
rootfs when using dracut. For now work around this problem by just not
setting root= in clr-boot-manager when the Oracle is the kernel type.
---
 src/bootloaders/systemd-class.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/bootloaders/systemd-class.c b/src/bootloaders/systemd-class.c
index 22658fa..00b0f03 100644
--- a/src/bootloaders/systemd-class.c
+++ b/src/bootloaders/systemd-class.c
@@ -266,7 +266,9 @@ bool sd_class_install_kernel(const BootManager *manager, const Kernel *kernel)
                 cbm_writer_append_printf(writer, "rd.luks.name=%s=clr-root ", root_dev->luks_uuid);
                 cbm_writer_append_printf(writer, "rd.luks.options=timeout=90 ");
         } else {
-                if (root_dev->part_uuid) {
+                if (streq(kernel->meta.ktype, "oracle")) {
+                        cbm_writer_append_printf(writer, "options ");
+                } else if (root_dev->part_uuid) {
                         cbm_writer_append_printf(writer, "options root=PARTUUID=%s ", root_dev->part_uuid);
                 } else {
                         cbm_writer_append_printf(writer, "options root=UUID=%s ", root_dev->uuid);
-- 
2.17.0

